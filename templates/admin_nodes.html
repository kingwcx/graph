{% extends 'admin_nav.html' %}

{% block content %}
    <div id="main" style="height: 600px;">
        <H2>概念集合 <small></small></H2>
        <hr>
        <div class="row">
            <div class="col-lg-3">
                <select class="form-control m-b" name="label">
                    {% for key,value in labels.items %}
                        <option value={{ key }}>{{ value }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <hr>
        <div class="row">
            <div id="cy" class="col-lg-12 col-md-12" style="height: 400px; background: #f9f9f9; text-align: initial">
        </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <a href="{% url "admin:add_example_view" %}" class="btn btn-default btn-md" role="button">添加成衣</a>
                <a href="{% url "admin:add_node_view" %}" class="btn btn-default btn-md" role="button">添加节点</a>
                <a href="#" class="btn btn-default btn-md" role="button">添加关系</a>
            </div>
        </div>

    </div>
    <!--script src="{% static 'custom/js/initialGraph.js' %}"></script-->
    <script>
    var jq = $.noConflict();
    jq(document).ready(function(){
        var style = [
            { selector: 'node[label = "Concept"]',
              css: {'background-color': '#6FB1FC', 'content': 'data(name)'}
            },
            { selector: 'node[label = "Style"]',
              css: {'background-color': '#fcf146', 'content': 'data(name)'}
            },
            { selector: 'node[label = "Example"]',
              css: {'background-color': '#F5A45D', 'content': 'data(name)'}
            },
            { selector: 'node[label = "Type"]',
              css: {'background-color': '#3844f5', 'content': 'data(name)'}
            },
            { selector: 'node[label = "Color"]',
              css: {'background-color': '#f52635', 'content': 'data(name)'}
            },
            { selector: 'node[label = "Fabrictype"]',
              css: {'background-color': '#6bf51e', 'content': 'data(name)'}
            },
            { selector: 'node[label = "People"]',
              css: {'background-color': '#f50e8f', 'content': 'data(name)'}
            },
            { selector: 'node[label = "Mould"]',
              css: {'background-color': '#3bf5ba', 'content': 'data(name)'}
            },
            { selector: 'node[label = "Designer"]',
              css: {'background-color': '#21f563', 'content': 'data(name)'}
            },
            { selector: 'edge',
              css: {'content': 'data(relationship)', 'target-arrow-shape': 'triangle'}
            }
        ];

        var elements = {
            nodes: [],
            edges: []
        };

        var layout = { name: 'circle'};

        jq.ajax({
            url:"{% url 'admin:load_graph' %}",
            type:"GET",

            {#请求成功回调函数#}
            success:function (data) {
                alert(data.nodes);
                alert("请求成功");
                var cy = cytoscape({
                container: document.getElementById('cy'),
                    style:style,
                    elements: {
                        nodes:data.nodes,
                        edges:data.edges,
                    },
                    layout: layout,
                });
            },
            {#请求失败回调函数#}
            error:function () {
                alert("服务器请求超时,请重试!");
            }

        });
    });
</script>
{% endblock %}
{% extends 'index_nav.html' %}

{% block content %}
    <div class="row">
        <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12 pull-right" style="left:0;position: absolute; Z-INDEX:2;">
            <ul class="list-group">
            {% for key,value in data.items %}
                <li id="{{ key }}" class="list-group-item">{{ value }}</li>
            {% endfor %}
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12 pull-right" style="right:0;position: absolute; Z-INDEX:2;">
            <div id="panel" class="panel panel-info">
                <div id="panel-head" class="panel-heading">Panel heading</div>
                <div id="panel-body" class="panel-body">
                    <p>...</p>
                    <form action="{% url 'front:object_detail' %}" method="post">
                        <input id="panel-input" name="id" type="text" class="hidden">
                        <button id="panel-button" type="submit" class="btn btn-info center-block">查看详情</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div id="cy" class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="height: 600px; text-align: initial;background-color: #2aabd2"></div>
    </div>
    <script>
        var elements;
        var style = [
            { selector: 'node[label = "Design"]',
              css: {'background-color': '#fc33b6', 'content': 'data(name)'}
            },
            { selector: 'node[label = "Process"]',
              css: {'background-color': '#6FB1FC', 'content': 'data(name)'}
            },
            { selector: 'node[label = "Style"]',
              css: {'background-color': '#fcf146', 'content': 'data(name)'}
            },
            { selector: 'node[label = "People"]',
              css: {'background-color': '#fcf146', 'content': 'data(name)'}
            },
            { selector: 'edge',
              css: {'content': 'data(relationship)', 'target-arrow-shape': 'triangle'}
            }
        ];
        function edit_panel(current_data)
        {
            $("#panel-head").text(current_data.property.name);
            var txt1=$("<p></p>").text(current_data.property.description);  // 使用 jQuery 创建文本
            $("#panel-body p:first").remove();
            $("#panel-body").prepend(txt1);        // 追加新元素

            $("#panel-input").attr({"value" : current_data.id,});
        }
        $(function(){
        　　$("#{{ ids.0 }}").addClass("active");
            $("#{{ ids.0 }}").trigger("click");
        });
        $("li").click(function(){
            $("li").removeClass("active");
            $(this).addClass("active");
            $.post("{% url 'admin:find_node' %}",
            {
                id:$(this).attr('id'),
            },
                function(data){
                edit_panel(data.current_data);

                elements = data.elements;
                var cy = cytoscape({
                    container: document.getElementById('cy'),
                    style:style,
                    elements:elements,
                });
                var layout = cy.layout({
                    name: 'concentric',
                    fit:true,
                    padding: 30, // the padding on fit
                    startAngle:4/ 2 * Math.PI, // where nodes start in radians
                    sweep: undefined, // how many radians should be between the first and last node (defaults to full circle)
                    clockwise: true, // whether the layout should go clockwise (true) or counterclockwise/anticlockwise (false)
                    equidistant: false, // whether levels have an equal radial distance betwen them, may cause bounding box overflow
                    minNodeSpacing: 100 ,// min spacing between outside of nodes (used for radius adjustment)
                });
                layout.run();
                cy.on('tap', 'node', function(evt){
                    var node = evt.target;
                    console.log( 'tapped ' + node.id());
                    $.post("{% url 'admin:find_node' %}",
                    {
                        id:node.id(),
                    },
                        function(data) {
                            cy.add(data.elements);
                            var layout = cy.layout({
                                name: 'concentric',
                                fit:true,
                                padding: 30, // the padding on fit
                                startAngle:4/ 2 * Math.PI, // where nodes start in radians
                                sweep: undefined, // how many radians should be between the first and last node (defaults to full circle)
                                clockwise: true, // whether the layout should go clockwise (true) or counterclockwise/anticlockwise (false)
                                equidistant: false, // whether levels have an equal radial distance betwen them, may cause bounding box overflow
                                minNodeSpacing: 100 ,// min spacing between outside of nodes (used for radius adjustment)
                            });
                            layout.run();
                            edit_panel(data.current_data);
                        });
                });
            });
        });
    </script>
{% endblock %}